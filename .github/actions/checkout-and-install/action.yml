name: Checkout and run yarn install
description: Checkouts out commit, sets up Node, and installs dependencies.

inputs:
  install-cache-name:
    description: Install cache name
    required: true

  registry-password:
    description: Internal registry password
    required: true

  registry-uri:
    description: Internal registry uri
    required: true

runs:
  using: composite
  steps:
    - name: Checkout the commit
      uses: actions/checkout@v2

    - name: Set up Node
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Configure internal registry
      uses: stardusttech-io/gha/.github/actions/configure-registry@master
      with:
        registry-password: ${{ inputs.registry-password }}
        registry-uri: ${{ inputs.registry-uri }}

    - name: Cache dependencies
      uses: actions/cache@v2
      with:
        path: ./node_modules
        key: ${{ runner.os }}-${{ inputs.install-cache-name }}-${{ hashFiles('**/yarn.lock') }}
        restore-keys: |
          ${{ runner.os }}-${{ inputs.install-cache-name }}-
          ${{ runner.os }}-

    - run: |
        if [[ "${{ steps.cache-dependencies.outputs.cache-hit }}" != "true" ]]; then yarn; fi
      shell: bash
